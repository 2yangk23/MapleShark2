using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace MapleShark
{
    class GMSKeys
    {
        private static Dictionary<ushort, byte[]> MapleStoryGlobalKeys = new Dictionary<ushort, byte[]>();

        private static bool _initialized = false;
        private static void Initialize()
        {
            // Add all keys known
            MapleStoryGlobalKeys.Add(121, new byte[] {
                0x5C, // 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x9E, 0x00, 0x00, 0x00, 0xAE, 0x00, 0x00, 0x00,
                0xC0, // 0x00, 0x00, 0x00, 0x94, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00,
                0xC0, // 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x00, 0x85, 0x00, 0x00, 0x00,
                0x86, // 0x00, 0x00, 0x00, 0xDD, 0x00, 0x00, 0x00, 0x41, 0x00, 0x00, 0x00, 0x1B, 0x00, 0x00, 0x00,
                0xEA, // 0x00, 0x00, 0x00, 0x73, 0x00, 0x00, 0x00, 0xB1, 0x00, 0x00, 0x00, 0xBC, 0x00, 0x00, 0x00,
                0x85, // 0x00, 0x00, 0x00, 0x8C, 0x00, 0x00, 0x00, 0x57, 0x00, 0x00, 0x00, 0xAC, 0x00, 0x00, 0x00,
                0x03, // 0x00, 0x00, 0x00, 0x75, 0x00, 0x00, 0x00, 0xC4, 0x00, 0x00, 0x00, 0x2C, 0x00, 0x00, 0x00,
                0x37, // 0x00, 0x00, 0x00, 0x8F, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
            });

            MapleStoryGlobalKeys.Add(120, new byte[] {
                0x8D, // 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0xA7, 0x00, 0x00, 0x00, 0xC6, 0x00, 0x00, 0x00,
                0xD5, // 0x00, 0x00, 0x00, 0xDC, 0x00, 0x00, 0x00, 0x41, 0x00, 0x00, 0x00, 0x56, 0x00, 0x00, 0x00,
                0xD0, // 0x00, 0x00, 0x00, 0xC4, 0x00, 0x00, 0x00, 0xE3, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
                0x2B, // 0x00, 0x00, 0x00, 0xA2, 0x00, 0x00, 0x00, 0xA6, 0x00, 0x00, 0x00, 0xAA, 0x00, 0x00, 0x00,
                0xA8, // 0x00, 0x00, 0x00, 0xFA, 0x00, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00, 0x5F, 0x00, 0x00, 0x00,
                0xFF, // 0x00, 0x00, 0x00, 0xC9, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x0B, 0x00, 0x00, 0x00,
                0x74, // 0x00, 0x00, 0x00, 0x53, 0x00, 0x00, 0x00, 0x62, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
                0xFE, // 0x00, 0x00, 0x00, 0xA1, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0xD4, 0x00, 0x00, 0x00,
            });

            MapleStoryGlobalKeys.Add(118, new byte[] {
                0x5A, // Full key's lost
                0x22, 
                0xFB, 
                0xD1, 
                0x8F, 
                0x93, 
                0xCD, 
                0xE6, 
            });

            _initialized = true;
        }

        public static byte[] GetKeyForVersion(ushort pVersion)
        {
            if (!_initialized) Initialize();
            // Get first version known
            for (; pVersion > 0; pVersion--)
            {
                if (MapleStoryGlobalKeys.ContainsKey(pVersion))
                {
                    byte[] key = MapleStoryGlobalKeys[pVersion];
                    byte[] ret = new byte[32];
                    for (int i = 0; i < 8; i++)
                        ret[i * 4] = key[i];

                    return ret;
                }
            }
            return null;
        }
    }
}
